import{b as te,a as vt}from"../chunks/CroP3Izp.js";import{o as ft,h as ye,v as pt,a3 as Ve,y as _t,B as mt,p as gt,q as bt,t as zt,a4 as qt}from"../chunks/B11Zin6s.js";import"../chunks/Bg9kRutz.js";import{i as xt}from"../chunks/BxiFlMN0.js";import{p as ht,aI as kt,a9 as ke,aa as At,t as f,a as yt,O as e,a8 as u,a7 as i,c as r,r as a,s as p,f as Ae,aj as wt,aJ as Ge,a0 as St}from"../chunks/D2BM3cv1.js";import{a as d,t as v,e as ge,d as Re,s as q}from"../chunks/CRc66pB2.js";import{a as Qt}from"../chunks/C6CPo2A3.js";import{p as $t,i as $}from"../chunks/C5aigyhq.js";import{e as We,i as Xe}from"../chunks/BbljCwWF.js";import{a as Me,t as ne,b as Ke,s as Ne}from"../chunks/DoWIUU7Y.js";import{s as It,b as jt,a as be}from"../chunks/BRe-H2Zv.js";import{B as Ct}from"../chunks/BV8Qt9OW.js";import{N as Mt,A as Nt}from"../chunks/Qa4b1zFn.js";import{A as Ue}from"../chunks/DEJK9EAC.js";import{T as Ft}from"../chunks/Yb6izfNT.js";let Fe=null;async function Ye(){return Fe||(Fe=await ft("quiz",1,{upgrade(x){const g=x.createObjectStore("quiz",{keyPath:"date"});g.createIndex("collection, book",["collection","book"]),g.createIndex("date","date")}})),Fe}async function Tt(x){try{const g=await Ye();if(!g){console.error("Failed to open quiz database");return}const h=new Date()[Symbol.toPrimitive]("number"),M=ye.bookCollections.find(j=>j.id===x.collection).books.findIndex(j=>j.id===x.book),I={...x,date:h,bookIndex:M};await g.add("quiz",I)}catch(g){console.error("Error adding quiz result:",g)}}async function Et(x){return(await(await Ye()).getAllFromIndex("quiz","collection, book")).some(O=>O.book===x&&O.pass)}async function Pt({params:x,fetch:g}){const h=x.id,O=x.collection,M=ye.bookCollections.find(l=>l.id===O),I=M.books.find(l=>l.id===h);let j=!1,N=null,ce=null;if(I.quizFeatures["access-type"]==="after"&&(N=I.quizFeatures["access-after"],j=!await Et(N)),j&&N){const l=M.books.find(oe=>oe.id===N);ce=l?l.name:N}let X,k=0;if(!j)try{const l=await g(`${te}/collections/${O}/quizzes/${h}.json`);if(!l.ok)throw new Error("Failed to fetch quiz JSON file");X=await l.json(),k=X.passScore}catch(l){console.error("Error fetching quiz JSON file:",l)}return{quiz:X,locked:j,quizId:h,quizName:I.name,dependentQuizId:N,dependentQuizName:ce,passScore:k}}const go=Object.freeze(Object.defineProperty({__proto__:null,load:Pt},Symbol.toStringTag,{value:"Module"}));var Bt=v('<div class="flex items-center"><div class="flex"><button class="dy-btn dy-btn-ghost dy-btn-circle"><!></button></div>  <label class="dy-btn dy-btn-ghost p-0.5 dy-no-animation"><!></label></div>'),Ot=v('<div class="quiz-locked"><div class="quiz-locked-title"> </div> <div class="quiz-locked-message">Before accessing this quiz, you need to pass the following quiz:</div> <div class="quiz-locked-name"> </div></div>'),Dt=v("<p>Quiz result saved!</p>"),Ht=v("<p> </p>"),Lt=v('<div class="score"><div id="content" class="text-center"><div class="quiz-score-before"> </div> <div class="quiz-score-block"><span class="quiz-score"> </span></div> <div class="quiz-score-after"> </div> <div class="quiz-score-commentary"> </div></div></div> <!>',1),Jt=v('<img class="quiz-question-image h-40 svelte-3jb08n">'),Vt=v('<button class="w-5/6 md:w-64 lg:w-[20rem] mt-2"><div class="quiz-answer svelte-3jb08n"> </div></button>'),Gt=v('<div class="quiz-answer-explanation mt-4"> </div>'),Rt=v('<div class="quiz-question-block svelte-3jb08n"><div class="quiz-question"> <!></div> <div class="quiz-answer-block"><div></div></div> <!></div>'),Wt=v('<div class="w-full flex justify-center p-[4%] svelte-3jb08n"><img class="cursor-pointer svelte-3jb08n"></div>'),Xt=v('<div class="quiz-answer-explanation mt-4"> </div>'),Kt=v('<div class="quiz-question-block svelte-3jb08n"><div class="quiz-question"> </div> <div class="flex justify-center"><div></div></div> <!></div>'),Ut=v("<!> <!>",1),Yt=v('<div class="quiz-next-button arrow-ltr flex justify-center items-center" style="cursor: pointer;"><button class="dy-btn dy-btn-active p-2 px-8 mt-4"><!></button></div>'),Zt=v('<div class="quiz"><div id="content"><div class="quiz-question-number"> </div> <!> <!></div></div>'),eo=v('<div class="grid grid-rows-[auto,1fr] h-screen"><div class="navbar"><!></div> <!></div>');function bo(x,g){ht(g,!1);const[h,O]=It(),M=()=>be(gt,"$refs",h),I=()=>be(Ve,"$quizAudioActive",h),j=()=>be(bt,"$bodyFontSize",h),N=()=>be(zt,"$t",h),ce=()=>be(qt,"$bodyLineHeight",h),X=u(),k=u(),l=u(),oe=u(),ze=u(),we=u(),Te=u();let le=$t(g,"data",8),ie=u(-1),Se=u(!1),K=u([]),ae=u([]),D=u(0),F=u(0),n=u(),H=u(!1),U=u(!1),de=null,ue=null,ve=null,L=u("");const Ee=pt(ye.programVersion,"12.0")<0?"assets":"quiz";function Pe(t){const o=Math.floor(Math.random()*t.length);return t[o]}function fe(t,o,s="answer"){let _=new Audio;s==="question"&&(de=_),s==="answer"&&(ue=_),s==="explanation"&&(ve=_),_.src=t,_.onended=function(){o&&o()},_.play()}vt(()=>{pe(),He()});function Ze(){de&&(de.pause(),de.currentTime=0,de=null)}function et(){ue&&(ue.pause(),ue.currentTime=0,ue=null)}function tt(){ve&&(ve.pause(),ve.currentTime=0,ve=null)}function pe(){Ze(),et(),tt()}function Be(t){return`${te}/illustrations/${M().collection}-${e(k).id}-${t}`}function ot(t){let o=t.length,s;for(;o!=0;)s=Math.floor(Math.random()*o),o--,[t[o],t[s]]=[t[s],t[o]];return t}function it(t){let o=t.length,s;for(;o!==0;)s=Math.floor(Math.random()*o),o--,[t[o],t[s]]=[t[s],t[o]];return t}function Oe(){if(i(L,""),e(F)==e(ae).length)i(K,[]),De(e(D));else{i(n,e(ae)[e(F)]);for(const t of e(n).answers)t.clicked=!1;i(K,ot(e(n).answers))}}function De(t){let o="";for(const s of e(k).commentary)if(t>=s.rangeMin&&t<=s.rangeMax){o=s.message;break}return o}function at(){pe(),Ge(F),i(H,!1),i(U,!1),Oe(),Je()}function He(){i(H,!1),i(U,!1),i(K,[]),i(L,"")}function st(t,o){let s;return o?s=t.rightAnswerAudio?"clips/"+Pe(t.rightAnswerAudio):Ee+"/quiz-right-answer.mp3":s=t.wrongAnswerAudio?"clips/"+Pe(t.wrongAnswerAudio):Ee+"/quiz-wrong-answer.mp3",s}function Le(t){if(i(ie,-1),pe(),!e(H)){const o=st(e(k),t.correct),s=`${te}/${o}`;fe(s,()=>{!t.correct&&t.explanation&&t.explanation.text?(i(L,t.explanation.text),t.explanation.audio&&fe(`${te}/clips/${t.explanation.audio}`,null,"explanation")):!t.correct&&e(n).explanation&&e(n).explanation.text&&(i(L,e(n).explanation.text),e(n).explanation.audio&&fe(`${te}/clips/${e(n).explanation.audio}`,null,"explanation"))}),t.correct&&Ge(D),setTimeout(()=>{t.clicked=!0,i(H,!0),t.correct?i(U,!0):setTimeout(()=>{i(U,!0)},1e3)},0)}}function Je(){if(I()){const t=rt();if(t)if(t.audio){const o=()=>{Qe(0)};fe(`${te}/clips/${t.audio}`,o,"question")}else Qe(0)}}function Qe(t){if(e(n)&&I())if(t<e(n).answers.length){const o=e(n).answers[t];if(o.audio){const s=()=>{i(ie,-1),Qe(t+1)};i(ie,t),fe(`${te}/clips/${o.audio}`,s,"answer")}}else i(ie,-1)}function rt(){return e(ae)[e(F)]}kt(()=>{pe()}),ke(()=>(e(X),e(k),e(l),e(oe),e(ze),wt(le())),()=>{(t=>(i(X,t.locked),i(k,t.quiz),i(l,t.quizId),i(oe,t.quizName),i(ze,t.passScore)))(le())}),ke(()=>(M(),e(l)),()=>{i(we,ye.bookCollections.find(t=>t.id===M().collection).books.find(t=>t.id===e(l)))}),ke(()=>e(oe),()=>{i(Te,e(oe)||"Quiz")}),ke(()=>(e(k),e(we)),()=>{e(k)?(He(),i(D,0),i(F,0),i(K,[]),i(ae,e(we).quizFeatures["shuffle-questions"]?it([...e(k).questions]):[...e(k).questions]),Oe(),Je(),i(Se,!1)):(pe(),i(D,0),i(F,0),i(K,[]),i(ae,[]),i(Se,!1))}),At(),xt();var qe=eo(),$e=r(qe),nt=r($e);Mt(nt,{start:s=>{Ct(s,{get displayLabel(){return e(Te)}})},end:s=>{var _=Bt(),J=r(_),A=r(J),V=r(A);{var G=y=>{Ue.Volume(y,{color:"white"})},T=y=>{Ue.Mute(y,{color:"white"})};$(V,y=>{I()?y(G):y(T,!1)})}a(A),a(J);var E=p(J,2),se=r(E);Ft(se,{color:"white"}),a(E),a(_),ge("click",A,()=>{jt(Ve,!I())}),ge("click",E,()=>_t.open(mt)),d(s,_)},$$slots:{start:!0,end:!0}}),a($e);var ct=p($e,2);{var lt=t=>{var o=Ot(),s=r(o),_=r(s,!0);a(s);var J=p(s,4),A=r(J,!0);a(J),a(o),f(()=>{q(_,le().quizId),q(A,le().dependentQuizName||le().dependentQuizId)}),d(t,o)},dt=t=>{var o=Re(),s=Ae(o);{var _=A=>{var V=Lt(),G=Ae(V),T=r(G),E=r(T),se=r(E,!0);a(E);var y=p(E,2),xe=r(y),Ie=r(xe,!0);a(xe),a(y);var w=p(y,2),R=r(w,!0);f(()=>q(R,N().Quiz_Score_Page_Message_After.replace("%n%",e(F)))),a(w);var P=p(w,2),_e=r(P,!0);f(()=>q(_e,De(e(D)))),a(P),a(T),a(G);var je=p(G,2);{var Ce=S=>{var m=Re();const C=St(()=>e(D)>=e(ze));var re=Ae(m);Qt(re,()=>Tt({collection:M().collection,book:e(l),score:e(D),passScore:e(ze),pass:e(C)}),null,(B,W)=>{var Q=Dt();d(B,Q)},(B,W)=>{var Q=Ht(),Y=r(Q);a(Q),f(()=>q(Y,`Error saving quiz result: ${e(W).message??""}`)),d(B,Q)}),d(S,m)};$(je,S=>{e(Se)||S(Ce)})}f(()=>{q(se,N().Quiz_Score_Page_Message_Before),q(Ie,e(D))}),d(A,V)},J=A=>{var V=Zt(),G=r(V),T=r(G),E=r(T,!0);a(T);var se=p(T,2);{var y=w=>{var R=Ut(),P=Ae(R);{var _e=S=>{var m=Rt(),C=r(m),re=r(C),B=p(re);{var W=z=>{var c=Jt();f(()=>Ne(c,"src",Be(e(n).image))),d(z,c)};$(B,z=>{e(n).image&&z(W)})}a(C);var Q=p(C,2),Y=r(Q);We(Y,5,()=>e(K),Xe,(z,c,ee)=>{var he=Vt(),me=r(he),ut=r(me,!0);a(me),a(he),f(()=>{ne(me,"textCorrectSelect",e(H)&&e(c).correct&&(e(c).clicked||e(U))),ne(me,"textWrongSelect",e(H)&&e(c).clicked&&!e(c).correct),ne(me,"textHighlight",e(ie)===ee),q(ut,e(c).text)}),ge("click",he,()=>{Le(e(c))}),d(z,he)}),a(Y),a(Q);var Z=p(Q,2);{var b=z=>{var c=Gt(),ee=r(c,!0);a(c),f(()=>q(ee,e(L))),d(z,c)};$(Z,z=>{e(L)&&z(b)})}a(m),f(()=>{Me(C,"line-height",`${ce()??""}%`),q(re,`${e(n).text??""} `),Ke(Y,`grid grid-cols-${e(n).columns??1??""} justify-items-center svelte-3jb08n`)}),d(S,m)};$(P,S=>{e(n).answers.some(m=>m.text)&&S(_e)})}var je=p(P,2);{var Ce=S=>{var m=Kt(),C=r(m),re=r(C,!0);a(C);var B=p(C,2),W=r(B);We(W,5,()=>e(K),Xe,(Z,b,z)=>{var c=Wt(),ee=r(c);f(()=>Ne(ee,"src",Be(e(b).image))),a(c),f(()=>{ne(c,"imageCorrectSelect",e(H)&&e(b).correct&&(e(b).clicked||e(U))),ne(c,"imageWrongSelect",e(H)&&e(b).clicked&&!e(b).correct),ne(c,"textHighlight",e(ie)===z),Ne(ee,"alt",e(b).text)}),ge("click",ee,()=>{Le(e(b))}),d(Z,c)}),a(W),a(B);var Q=p(B,2);{var Y=Z=>{var b=Xt(),z=r(b,!0);a(b),f(()=>q(z,e(L))),d(Z,b)};$(Q,Z=>{e(L)&&Z(Y)})}a(m),f(()=>{q(re,e(n).text),Ke(W,`grid grid-cols-${e(n).columns??2??""} gap-2 svelte-3jb08n`)}),d(S,m)};$(je,S=>{e(n).answers.some(m=>m.image)&&S(Ce)})}d(w,R)};$(se,w=>{e(n).answers&&w(y)})}var xe=p(se,2);{var Ie=w=>{var R=Yt(),P=r(R),_e=r(P);Nt(_e,{}),a(P),a(R),ge("click",P,()=>{at()}),d(w,R)};$(xe,w=>{e(U)&&w(Ie)})}a(G),a(V),f(()=>{Me(T,"line-height",`${ce()??""}%`),q(E,e(F)+1)}),d(A,V)};$(s,A=>{e(F)==e(ae).length?A(_):A(J,!1)},!0)}d(t,o)};$(ct,t=>{e(X)?t(lt):t(dt,!1)})}a(qe),f(()=>Me(qe,"font-size",`${j()??""}px`)),d(x,qe),yt(),O()}export{bo as component,go as universal};
